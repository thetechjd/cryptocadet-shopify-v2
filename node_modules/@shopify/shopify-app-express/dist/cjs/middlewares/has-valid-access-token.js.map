{"version":3,"file":"has-valid-access-token.js","sources":["../../../../src/middlewares/has-valid-access-token.ts"],"sourcesContent":["import {HttpResponseError, Session, Shopify} from '@shopify/shopify-api';\n\nconst TEST_GRAPHQL_QUERY = `query shopifyAppShopName {\n  shop {\n    name\n  }\n}`;\n\nexport async function hasValidAccessToken(\n  api: Shopify,\n  session: Session,\n): Promise<boolean> {\n  try {\n    const client = new api.clients.Graphql({session});\n    await client.request(TEST_GRAPHQL_QUERY);\n    return true;\n  } catch (error) {\n    if (error instanceof HttpResponseError && error.response.code === 401) {\n      // Re-authenticate if we get a 401 response\n      return false;\n    } else {\n      throw error;\n    }\n  }\n}\n"],"names":["HttpResponseError"],"mappings":";;;;AAEA,MAAM,kBAAkB,GAAG,CAAA;;;;EAIzB;AAEK,eAAe,mBAAmB,CACvC,GAAY,EACZ,OAAgB,EAAA;AAEhB,IAAA,IAAI;AACF,QAAA,MAAM,MAAM,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,EAAC,OAAO,EAAC,CAAC;AACjD,QAAA,MAAM,MAAM,CAAC,OAAO,CAAC,kBAAkB,CAAC;AACxC,QAAA,OAAO,IAAI;IACb;IAAE,OAAO,KAAK,EAAE;AACd,QAAA,IAAI,KAAK,YAAYA,4BAAiB,IAAI,KAAK,CAAC,QAAQ,CAAC,IAAI,KAAK,GAAG,EAAE;;AAErE,YAAA,OAAO,KAAK;QACd;aAAO;AACL,YAAA,MAAM,KAAK;QACb;IACF;AACF;;;;"}